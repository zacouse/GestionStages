
@{
    ViewData["Title"] = lang.ListeStage;
}

<h1>@lang.ListeStage</h1>


@{
    if (ViewBag.error != null && ViewBag.error != "")
    {
        @Html.Raw(ViewBag.error);
    }
}

<div id="search">
    <h3>@lang.FiltreDeRecherche</h3>
    <div>
        <form name="searchform" method="post" action="@Url.Action("SearchListeStage", "Stage")">
            <div class="row">
                <div class="col s3">
                    <div class="input-field">
                        @Html.TextBox("txtTitre", "")
                        <label for="txtTitre">@lang.Titre</label>
                    </div>
                    <div class="input-field">
                        @Html.TextBox("txtDescr", "")
                        <label for="txtDescr">@lang.Description</label>
                    </div>
                    <div class="input-field">
                        @Html.TextBox("txtMilieu", "")
                        <label for="txtMilieu">@lang.MilieuDeStage</label>
                    </div>
                </div>

                <div class="col s2">
                    <label>@lang.PeriodeDeTravail</label>
                    <div class="input-field row">
                        <p>
                            <label>
                                @Html.CheckBox("chkIsJour", true, new { @class = "filled-in" })
                                <span>@lang.Jour</span>
                            </label>
                        </p>
                    </div>
                    <div class="input-field row">
                        <p>
                            <label>
                                @Html.CheckBox("chkIsSoir", true, new { @class = "filled-in" })
                                <span>@lang.Soiree</span>
                            </label>
                        </p>
                    </div>
                    <div class="input-field row">
                        <p>
                            <label>
                                @Html.CheckBox("chkIsNuit", true, new { @class = "filled-in" })
                                <span>@lang.Nuit</span>
                            </label>
                        </p>
                    </div>
                </div>

                <div class="col s3">
                    <div class="input-field">
                        @Html.TextBox("txtMinH", "")
                        <label for="txtMinH">@lang.NombreMinimumDHeureSemaine</label>
                    </div>
                    <div class="input-field">
                        @Html.TextBox("txtMaxH", "")
                        <label for="txtMaxH">@lang.NombreMaximumDHeureSemaine</label>
                    </div>
                </div>

                <div class="col s3">
                    <div class="input-field">
                        @Html.TextBox("txtMinDate", "", new { @class = "datepicker", placeholder = "yyyy-MM-dd", type = "date" })
                        <label for="txtMinDate">@lang.DateDeDebut</label>
                    </div>
                    <div class="input-field">
                        @Html.TextBox("txtMaxDate", "", new { @class = "datepicker", placeholder = "yyyy-MM-dd", type = "date" })
                        <label for="txtMaxDate">@lang.DateDeFin</label>
                    </div>
                </div>
                @if (!ViewBag.isStudent)
                {
                    <div class="col s3">
                        <div class="row">
                            <div class="col s2">
                                <p>
                                    <label>@lang.Etat</label>
                                </p>
                            </div>
                            <div class="col s4">
                                <p>
                                    <label>
                                        @Html.CheckBox("chkIsActive", true, new { @class = "filled-in" })
                                        <span>@lang.Actif</span>
                                    </label>
                                </p>
                            </div>
                            <div class="col s4">
                                <p>
                                    <label>
                                        @Html.CheckBox("chkIsInactive", true, new { @class = "filled-in" })
                                        <span>@lang.Inactif</span>
                                    </label>
                                </p>
                            </div>
                        </div>
                    </div>
                }

                <div class="col xl3 l4 m4 s4">
                    <a class="btn light-blue white-text" href="javascript:document.searchform.submit();">@lang.Rechercher<i class="material-icons right hide-on-med-and-down">search</i></a>
                </div>
                <div class="col xl3 l4 m4 s4">
                    <a class="btn light-green white-text" href="@Url.Action("ListeStage", "Stage")">@lang.Reset<i class="material-icons right hide-on-med-and-down">autorenew</i></a>
                </div>
            </div>
        </form>
    </div>
</div>

<table id="liste" class="highlight responsive-table">
    <thead>
        <tr>
            <td>@lang.Titre</td>
            <td>@lang.Description</td>
            <td>@lang.MilieuDeStage</td>
            <td>@lang.PeriodeDeTravail</td>
            <td>@lang.Statut</td>
            <td>@lang.NombreDHeureParSemaine</td>
            <td>@lang.DateDeDebut</td>
            <td>@lang.DateDeFin</td>
            <td>@lang.Voir</td>
            @if (ViewBag.isStudent)
            {
                <td>#Choix</td>
            }
        </tr>
    </thead>
    <tbody>
        @{
            List<Stage> lesStages = ViewBag.lesStages;
            for (int i = 0; i < lesStages.Count; i++)
            {
                <tr>
                    <td>@lesStages[i].Titre</td>
                    <td>@lesStages[i].Description</td>
                    <td>@lesStages[i].TitreMilieuStage</td>
                    <td>@lesStages[i].GetPeriode()</td>
                    <td>@lesStages[i].GetStatus()</td>
                    <td>@lesStages[i].NbHeureSemaine h</td>
                    <td>@{@lesStages[i].DateDebut.ToString("d");}</td>
                    <td>@{@lesStages[i].DateFin.ToString("d");}</td>
                    <td><a href="@Url.Action("VisionnerStage", "Stage", new { id = lesStages[i].IDStage, isStudent = false })"><i class="material-icons orange-text">remove_red_eye</i></a></td>
                    @if (ViewBag.isStudent)
                    {
                        <td>
                            <select onchange="applyChoice(this);" id="@lesStages[i].IDStage" class="choixPossible browser-default">
                                <option></option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </td>
                    }
                </tr>
            }
        }
    </tbody>

</table>
<form name="ChoiceForm" method="post" action="@Url.Action("AddSetChoixStage", "Stage")">
    <div class="hiddendiv">
        <input id="Choix1" name="Choix1" type="text" value="" required>
    </div>
    <div class="hiddendiv">
        <input id="Choix2" name="Choix2" type="text" value="" required>
    </div>
    <div class="hiddendiv">
        <input id="Choix3" name="Choix3" type="text" value="" required>
    </div>
    <div >
        <input id="IdEtudiant" name="IdEtudiant" type="text" value="" required>
    </div>
</form>

<div class="row" style="padding-top:5px;">
    <div class="col s2"><a class="btn grey" href="@Url.Action("Index", "Home")">@lang.Retour</a></div>
    @*mettre le if*@
    @if (!ViewBag.isStudent)
    {
        <div class="col s2 push-s3"><a class="btn blue" href="javascript:PrintElem('liste');">@lang.Imprimer<i class="material-icons right hide-on-small-and-down">print</i></a></div>
        <div class="col s2 push-s6"><a class="btn green" href="@Url.Action("AddSetStage", "Stage")">@lang.Ajouter<i class="material-icons right hide-on-small-and-down">add</i></a></div>
    }
    else
    {
        <div class="col s2 push-s8"><a class="btn green" href="javascript:document.ChoiceForm.submit();">@lang.Choisir<i class="material-icons right hide-on-small-and-down">check</i></a></div>
    }

</div>

@section Scripts
{
    <script>
        $(document).ready(function () {
            $("#search").accordion({
                collapsible: true
            });
            $('select').formSelect();
            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                showClearBtn: true,
                defaultDate: new Date(),
                i18n: {
                    months: ['@lang.Janvier' , '@lang.Fevrier', '@lang.Mars','@lang.Avril', '@lang.Mai', '@lang.Juin', '@lang.Juillet', '@lang.Aout', '@lang.Septembre', '@lang.Octobre', '@lang.Novembre', '@lang.Decembre'],
                    monthsShort: ['@lang.JanvierShort', '@lang.FevrierShort', '@lang.MarsShort', '@lang.AvrilShort', '@lang.MaiShort', '@lang.JuinShort', '@lang.JuilletShort', '@lang.AoutShort', '@lang.SeptembreShort', '@lang.OctobreShort', '@lang.NovembreShort', '@lang.DecembreShort'],
                    weekdays: ['@lang.Dimanche', '@lang.Lundi', '@lang.Mardi', '@lang.Mercredi', '@lang.Jeudi', '@lang.Vendredi', '@lang.Samedi'],
                    weekdaysShort: ['@lang.DimancheShort', '@lang.LundiShort', '@lang.MardiShort', '@lang.MercrediShort', '@lang.JeudiShort', '@lang.VendrediShort', '@lang.SamediShort'],
                    weekdaysAbbrev: ['@lang.DimancheAbbrev', '@lang.LundiAbbrev', '@lang.MardiAbbrev', '@lang.MercrediAbbrev', '@lang.JeudiAbbrev', '@lang.VendrediAbbrev', '@lang.SamediAbbrev'],
                    cancel: '@lang.Annuler',
                    clear: '@lang.Effacer',
                    dateFormat: 'dd-mm-yy'
                }
            });
        });

        function applyChoice(sel) {
             //enlever les autre select avec la même valeur
            for (var i = 1; i < 4; i++) {
                if (document.getElementById('Choix' + i).value == sel.id) {
                    alert("supress");
                    document.getElementById('Choix' + i).value == "";
                }
            }
            document.getElementById('Choix' + sel.value).value = sel.id;
            alert('Choix' + sel.value);
            alert(document.getElementById('Choix' + sel.value).value);
        }

        function PrintElem(elem) {
            var mywindow = window.open('@Url.Action("PrintListeStage", "Stage")', 'PRINT', 'height=1000,width=1000');

            mywindow.document.close(); // necessary for IE >= 10
            mywindow.focus(); // necessary for IE >= 10*/

            mywindow.print();

            return true;
        }

    </script>
}
<style>
    .ui-state-active {
        background: none;
        background-color: orange;
        color: white;
    }
</style>
